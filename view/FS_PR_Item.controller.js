/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("ui.s2p.mm.purord.fromrequisition.util.Formatter");jQuery.sap.require("sap.ca.ui.utils.busydialog");sap.ca.scfld.md.controller.BaseFullscreenController.extend("ui.s2p.mm.purord.fromrequisition.view.FS_PR_Item",{oParams:{},onInit:function(e){sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="pr_Item"){this.sCallerId=this.oParams.sCallerId;this.oList=this.oParams.oList;if(this.sCallerId){this.byId("btnPreviousPRItem").setVisible(true);this.byId("btnNextPRItem").setVisible(true);this.oModel=sap.ui.getCore().byId(this.sCallerId).getModel("PR_appr_model");if(!this.oModel){this.oModel=sap.ui.getCore().byId(this.sCallerId).getModel("PR_ass_model")}this.iNumberOfItems=this.oModel.getProperty("/PRItemCollection").length;this.ReadLocalData()}else{this.byId("btnPreviousPRItem").setVisible(false);this.byId("btnNextPRItem").setVisible(false);sap.ca.ui.utils.busydialog.requireBusyDialog();this.getView().getModel().read("/PRItemCollection('"+e.getParameter("arguments").prKey+"')",null,null,true,jQuery.proxy(this.onOdataReadSuccess,this),jQuery.proxy(this.onOdataReadError,this))}}},this)},onOdataReadError:function(e){sap.ca.ui.utils.busydialog.releaseBusyDialog();var m=this.oApplicationImplementation.getResourceBundle().getText('view.POfromPR.general_error_unassigned_message');var d="";if(e.message&&e.response){d=e.message+"\n"+e.response.requestUri+"\n"+e.response.statusText}ui.s2p.mm.purord.fromrequisition.Common.ShowErrorMessage(m,d)},onOdataReadSuccess:function(d){sap.ca.ui.utils.busydialog.releaseBusyDialog();var m=new sap.ui.model.json.JSONModel(d);this.getView().setModel(m,"PR_item_model")},ReadLocalData:function(){var p=this.oParams.sPath?("/"+this.oParams.sPath.split("/")[1]+"/"):undefined;var c=this.oParams.sPath?(this.oParams.sPath.split(p)[1]):undefined;var m=new sap.ui.model.json.JSONModel();m.setData(this.oModel.getProperty(p+c));this.getView().setModel(m,"PR_item_model");},getPreviousItem:function(c){var i=(this.oList.indexOf(parseInt(c))-1>=0?this.oList.indexOf(parseInt(c))-1:this.oList.indexOf(parseInt(c)));return this.oList[i]},getNextItem:function(c){var i=(this.oList.indexOf(parseInt(c))+1<this.oList.length?this.oList.indexOf(parseInt(c))+1:this.oList.indexOf(parseInt(c)));return this.oList[i]},getIndexInListFromIndexInModel:function(c){if(this.oList)return this.oList.indexOf(parseInt(c));return-1},onOtherPRItem:function(e){var p=this.oParams.sPath?("/"+this.oParams.sPath.split("/")[1]+"/"):undefined;var c=this.oParams.sPath?(this.oParams.sPath.split(p)[1]):undefined;var i=this.getIndexInListFromIndexInModel(c);var o;var P;if(e.getSource()==this.oView.byId("btnPreviousPRItem")){if(i!=-1){if(i>"0"){o=p+this.getPreviousItem(c);P=this.oModel.getProperty(o);this.oParams.sPath=o;this.oRouter.navTo("pr_Item",{prKey:P.PRKey},true)}}}else if(e.getSource()==this.oView.byId("btnNextPRItem")){if(i!=-1){if(i<this.iNumberOfItems-1){o=p+this.getNextItem(c);P=this.oModel.getProperty(o);this.oParams.sPath=o;this.oRouter.navTo("pr_Item",{prKey:P.PRKey},true)}}}},onBack:function(){var h=sap.ui.core.routing.History.getInstance();var d=h.getDirection("");if(d===sap.ui.core.routing.HistoryDirection.Unknown){this.oRouter.navTo("fullscreen",{})}else{window.history.go(-1)}},onSupplierLink:function(e){var m=this.getView().getModel("PR_item_model");this.oRouter.navTo("supplier",{supplierId:m.getProperty("/SupplierId"),companyCode:m.getProperty("/CompanyCode"),purchasingOrganization:m.getProperty("/PurchasingOrganization")})},formatSupplierOrPlant:function(s,p){return(s)?s:p}});
