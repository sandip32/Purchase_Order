/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.ui.model.format.QuantityFormat");jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");sap.ui.core.mvc.Controller.extend("ui.s2p.mm.purord.fromrequisition.view.PO_Created",{oParams:{},onInit:function(){this.oBundle=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();this.sStatusSaved=this.oBundle.getText("view.POfromPR_Status.saved");this.sStatusSent=this.oBundle.getText("view.POfromPR_Status.sent");this.sPO=this.oBundle.getText("view.PO_List.po_id");this.sSupplier=this.oBundle.getText("view.PO_List.supplier");this.sTotal=this.oBundle.getText("view.PO_List.total");this.sTitle=this.oBundle.getText("view.POfromPR.sort_tit");this.oList=this.byId("PO_Created_List");this.bResponderOn=jQuery.sap.getUriParameters().get("responderOn");this.sPathToMockFile="/ui.s2p.mm.purord.fromrequisition/mock/createdPurchaseOrders.json";if(this.bResponderOn){this.oBackendModel=new sap.ui.model.json.JSONModel();this.oBackendModel.loadData(this.sPathToMockFile,"",false);if(this.oList){this.oList.setModel(this.oBackendModel)}this.renderPOs(this.oBackendModel)}},renderPOs:function(p){var l=[];if(!this.oList){return};l=this.oList.getItems();$.each(l,jQuery.proxy(function(a,b){var L=new sap.ui.layout.VerticalLayout();var c=new sap.ui.layout.VerticalLayout();var d=new sap.ui.layout.VerticalLayout();var P=p.getData().results[a];var s=undefined;var S=undefined;if(P.StatusId==2){S=this.sStatusSaved;jQuery.sap.log.info("status saved")}else if(P.StatusId==2){S=this.sStatusSent}else if(P.StatusId==3){S=this.sStatusSent;s=sap.ui.core.ValueState.Success}var o=new sap.m.ObjectStatus({text:S,state:s});var t=new sap.m.ObjectNumber({number:ui.s2p.mm.purord.fromrequisition.util.Formatter.lazyFormatNumber(P.Value),unit:P.Currency});d.addContent(t);d.addContent(o);$.each(p.getData().results[a].POItem.results,function(i,v){var D=new sap.m.Text({text:v.ProductDescription});var q=new sap.m.Text({text:sap.ca.ui.model.format.QuantityFormat.getInstance().format(v.QuantityFormatted)+" "+v.QtyUnitDescription,align:"End"});L.addContent(D);c.addContent(q)});l[a].insertCell(L,2);l[a].insertCell(c,3);l[a].insertCell(d,4)},this))},getList:function(){return this.byId("PO_Created_List")},onBeforeRendering:function(){if(!this.bResponderOn){this.oBackendModel=this.oParams.oModel}if(this.oList){this.oList.setModel(this.oBackendModel,"savedPOs")}this.renderPOs(this.oBackendModel)},getVSDialogSort:function(){var t=this;if(t.oVSDialog){return t.oVSDialog}var v=new sap.m.ViewSettingsDialog({sortItems:[new sap.m.ViewSettingsItem({text:t.oBundle.getText("view.PO_List.po_id"),key:"PoNumber",selected:true}),new sap.m.ViewSettingsItem({text:t.oBundle.getText("view.PO_List.supplier"),key:"SupplierName"}),new sap.m.ViewSettingsItem({text:t.oBundle.getText("view.PO_List.total"),key:"Value"}),],confirm:function(e){var p=e.getParameters();var i=t.oBackendModel.getData().results;var d=p.sortDescending;var s=p.sortItem.getKey();switch(s){case"PoNumber":if(!d){i.sort(function(a,b){if(a.PONumberFormatted<b.PONumberFormatted){return-1}if(a.PONumberFormatted>b.PONumberFormatted){return 1}return 0})}else{i.sort(function(a,b){if(a.PONumberFormatted<b.PONumberFormatted){return 1}if(a.PONumberFormatted>b.PONumberFormatted){return-1}return 0})}break;case"SupplierName":if(!d){i.sort(function(a,b){if(a.SupplierName<b.SupplierName){return-1}if(a.SupplierName>b.SupplierName){return 1}return 0})}else{i.sort(function(a,b){if(a.SupplierName<b.SupplierName){return 1}if(a.SupplierName>b.SupplierName){return-1}return 0})}break;case"Value":if(!d){i.sort(function(a,b){var V=parseFloat(a.Value);var c=parseFloat(b.Value);if(V<c){return-1}if(V>c){return 1}return 0})}else{i.sort(function(a,b){var V=parseFloat(a.Value);var c=parseFloat(b.Value);if(V<c){return 1}if(V>c){return-1}return 0})}break}if(t.oList){t.oList.setModel(null);t.oList.setModel(this.oBackendModel,"savedPOs")}t.onBeforeRendering()},});t.oVSDialog=v;return v}});
